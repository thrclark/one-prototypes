function SessionService(f,h,k){function g(b,c,a){a||(a=window.location.href);var e=RegExp("([?|\x26])"+b+"\x3d.*?(\x26|#|$)(.*)","gi");if(e.test(a)){if("undefined"!==typeof c&&null!==c)return a.replace(e,"$1"+b+"\x3d"+c+"$2$3");var d=a.split("#");a=d[0].replace(e,"$1$3").replace(/(&|\?)$/,"");"undefined"!==typeof d[1]&&null!==d[1]&&(a+="#"+d[1]);return a}"undefined"!==typeof c&&null!==c&&(e=-1!==a.indexOf("?")?"\x26":"?",d=a.split("#"),a=d[0]+e+b+"\x3d"+c,"undefined"!==typeof d[1]&&null!==d[1]&&(a+=
"#"+d[1]));return a}var l=null,m=null,n=null,p=null;this.setLogoutDelayMinutes=function(b){l=b;this.setLogoutTimer()};this.setLogoutTimer=function(){null!=m&&(clearTimeout(m),m=null);null!=n&&(clearTimeout(n),n=null);null!=p&&(k.removeAlert(p),p=null);if(null!=l&&0<l){var b=this;m=setTimeout(function(){p=k.addAlert("You will be logged out in one minute due to inactivity.","warning");n=setTimeout(function(){b.logout()},6E4)},6E4*(l-1))}};this.login=function(b){var c=g("logout",null),c=g("login","true",
c);"undefined"!=typeof b&&0<b.length&&(c=g("requestedAction",encodeURIComponent(b),c),(b=f.getCookie("XSRF-TOKEN"))&&(c=g("X-XSRF-TOKEN",b,c)));window.location=c};this.logout=function(){h.clearFilter();h.clearOfflineIds();window.location=contextPath+"/logout"};this.getRequestedAction=function(b,c){var a;a:{a=window.location.search.substring(1).split("\x26");for(var e=0;e<a.length;e++){var d=a[e].split("\x3d");if("requestedAction"==d[0]){a=d[1];break a}}a=!1}if(a){a=decodeURIComponent(a);for(index in c)if(a.startsWith(c[index])){b.$eval(a);
break}"function"==typeof history.pushState&&(a=g("requestedAction",null),a=g("X-XSRF-TOKEN",null,a),history.pushState(null,null,a))}};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(b){return this.slice(0,b.length)==b})}var SessionController=function(f,h,k){f.disableLoginButton=!1;f.login=function(){f.disableLoginButton=!0;h(function(){k.login()},0)};f.logout=function(){f.disableLoginButton=!0;h(function(){k.logout()},0)}};var HeaderController=function(a){a.menuOpen=!1;a.toggleMenu=function(b){"undefined"==typeof b&&(b=!a.menuOpen);b?($("#sidebar_menu").css({right:0,visibility:"visible"}),setTimeout(function(){$("#menuCloseButton").focus()},300)):($("#menu_button").focus(),$("#sidebar_menu").css({right:-227}),setTimeout(function(){$("#sidebar_menu").css({visibility:"hidden"})},400));a.menuOpen=b}};var taskStoreModule=angular.module("taskStore","ngTouch ngAnimate ngSanitize ngAria sharedDirectives ui.sortable ui.bootstrap.tpls ui.bootstrap.rating ngResponsiveImages".split(" ")).config(["$httpProvider",function(b){b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";b.interceptors.push("taskStoreHttpInterceptor")}]).controller("HeaderController",["$scope",HeaderController]).controller("SessionController",["$scope","$timeout","sessionService",SessionController]).factory("taskStoreHttpInterceptor",
["$q",function(b){return{request:function(a){return a||b.when(a)},requestError:function(a){return b.reject(a)},response:function(a){return a||b.when(a)},responseError:function(a){return b.reject(a)}}}]).factory("taskStoreService",["$http","$q","$interpolate","$compile","$filter","sessionService","searchService",function(b,a,e,f,c,d,g){return new TaskStoreService(b,a,e,f,c,d,g)}]).factory("alertService",["$timeout",function(b){return new AlertService(b)}]).factory("sessionService",["cookieService",
"searchService","alertService",function(b,a,e){return new SessionService(b,a,e)}]).factory("searchService",["$http",function(b){return new SearchService(b)}]).factory("cookieService",[function(){return new CookieService}]).factory("commentReplyService",["$injector","$http",function(b,a){return new CommentReplyService(b,a)}]).factory("mobileService",[function(){var b={isMobile:!1};$(document).ready(function(){$("body");if(navigator.userAgent.match(/IEMobile|Windows Phone/i))b.isMobile=!0;else{var a=
function(){var b={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return function(a){var c=document.createElement(b[a]||"div");a="on"+a;var d=a in c;d||(c.setAttribute(a,"return;"),d="function"==typeof c[a]);return d}}();b.isMobile=a("touchstart")}});return b}]);var AlertService=function(b){this.alerts=[];this.timeout=5E3;this.addAlert=function(c,d,e){var a={msg:c,type:d},f=this;b(function(){f.alerts.push(a)},0);e&&b(function(){f.removeAlert(a)},this.timeout);return a};this.removeAlert=function(c){var d=this.alerts.indexOf(c),e=$("#alert_"+d),a=this;e?(e.removeClass("in"),b(function(){a.alerts.splice(a.alerts.indexOf(c),1);b(function(){$("#alert_"+d).remove()},0)},500)):b(function(){a.alerts.splice(a.alerts.indexOf(c),1);b(function(){$("#alert_"+d).remove()},
0)},0)}};AlertService.$inject=["$timeout"];var SearchService=function(b){var d=288E5;this.getStoredFilter=function(){var a=(new Date).getTime(),c=store.get("searchStorageExpiration");c&&a>=c&&(a=store.get("searchFilter"),null!=a&&(a.tag=null,a.terms=null,a.categoryUniqueKey=null,a.taskCollectionUniqueKey=null,a.pageNumber=0,a.edit=!1,store.disabled||store.set("searchFilter",a)));return store.get("searchFilter")};this.saveFilter=function(a){"undefined"!=typeof store&&!store.disabled&&(store.set("searchFilter",a),"undefined"!=typeof store&&
!store.disabled&&(a=(new Date).getTime()+d,store.set("searchStorageExpiration",a)))};this.clearFilter=function(){if("undefined"!=typeof store&&!store.disabled){var a=store.get("searchFilter");a&&(a.tag=null,a.terms=null,a.categoryUniqueKey=null,a.taskCollectionUniqueKey=null,a.pageNumber=0,a.edit=!1,store.set("searchFilter",a))}};b({method:"GET",url:contextPath+"/pageData/storageExpiration"}).success(function(a,c,b,e){d=Number(a)});this.storeOfflineIds=function(){b({method:"GET",url:contextPath+"/offlineIds"}).success(function(a,
c,b,d){store.disabled||(a.favorites&&store.set("offlineFavorites",a.favorites),a.recentlyUsed&&store.set("offlineRecentlyUsed",a.recentlyUsed))})};this.clearOfflineIds=function(){"undefined"!=typeof store&&!store.disabled&&(store.remove("offlineFavorites"),store.remove("offlineRecentlyUsed"))};this.getOfflineFavorites=function(){return!store.disabled?store.get("offlineFavorites"):null};this.getOfflineRecentlyUsed=function(){return!store.disabled?store.get("offlineRecentlyUsed"):null}};
SearchService.$inject=["$http"];function CookieService(){this.createCookie=function(a,d,b,c,e){a=a+"\x3d"+escape(d)+";";b&&(b instanceof Date?isNaN(b.getTime())&&(b=new Date):b=new Date((new Date).getTime()+864E5*parseInt(b)),a+="expires\x3d"+b.toGMTString()+";");c&&(a+="path\x3d"+c+";");e&&(a+="domain\x3d"+e+";");document.cookie=a};this.getCookie=function(a){a+="\x3d";for(var d=document.cookie.split(";"),b=0;b<d.length;b++){for(var c=d[b];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(a))return c.substring(a.length,
c.length)}return null};this.deleteCookie=function(a,d,b){this.getCookie(a)&&this.createCookie(a,"",-1,d,b)}};function CommentService(d,e){this.findReportedComments=function(a,c){var b=contextPath+"/publish/comments/reported",b=b+("?pageNumber\x3d"+c);a&&(b+="\x26historical\x3dtrue");var f=e.defer();d({method:"GET",url:b}).success(function(b,c,a,d){f.resolve(b)}).error(function(b,c,a,d){f.reject(c)});return f.promise};this.findComment=function(a){var c=e.defer();d({method:"GET",url:contextPath+"/publish/comments/view/"+a}).success(function(b,f,a,d){c.resolve(b)}).error(function(b,f,a,d){c.reject(f)});return c.promise};
this.deleteComment=function(a){var c=e.defer();d({method:"POST",url:contextPath+"/publish/comment/delete",data:a}).success(function(b,f,a,d){c.resolve(b)}).error(function(b,a,d,e){c.reject(a)});return c.promise};this.acceptComment=function(a){var c=e.defer();d({method:"POST",url:contextPath+"/publish/comment/accept",data:a}).success(function(b,a,d,e){c.resolve(b)}).error(function(b,a,d,e){c.reject(a)});return c.promise}};function CommentReplyService(d,b){function c(){try{var a=d.get("sessionService");null!=a&&a.setLogoutTimer()}catch(b){}}this.saveCommentReply=function(a){c();return b({method:"POST",url:contextPath+"/comment/reply",data:a})};this.getCommentReply=function(a){c();return b({method:"GET",url:contextPath+"/comment/reply/"+a})};this.deleteCommentReply=function(a){c();return b({method:"POST",url:contextPath+"/comment/reply/delete",data:a})};this.getCommentRepliesNeedingReview=function(){return b({method:"GET",
url:contextPath+"/comment/replies/review"})}};function TaskStoreService(g,l,n,p,q,k,m){this.findTasks=function(a,b){k.setLogoutTimer();if(b){var d=m.getOfflineFavorites();a.offlineFavoriteUids=null!=d&&0<d.length?d:null;d=m.getOfflineRecentlyUsed();a.offlineRecentlyUsedUids=null!=d&&0<d.length?d:null}else a.offlineFavoriteUids=null,a.offlineRecentlyUsedUids=null;var c=l.defer();g({method:"POST",url:contextPath+"/tasks",data:a}).success(function(b,a,d,g){c.resolve(b)}).error(function(b,a,d,g){c.reject()});return c.promise};this.getPageData=function(a){k.setLogoutTimer();
var b=l.defer(),d=(new Date).getTime();g({method:"GET",url:contextPath+(a?"/pageData?uid\x3d"+a+"\x26_\x3d"+d:"/pageData?_\x3d"+d)}).success(function(a,d,f,h){b.resolve(a)}).error(function(a,d,f,h){b.reject()});return b.promise};this.rateTask=function(a){k.setLogoutTimer();var b=l.defer();g({method:"POST",url:contextPath+"/rating/post",data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.getComments=function(a,b,d,c,e){k.setLogoutTimer();var f=
l.defer(),h="/comment/list";a&&(h+="?uid\x3d"+a,a=(new Date).getTime(),h+="\x26_\x3d"+a,b&&(h=h+"\x26taskId\x3d"+b),h=d?h+"\x26page\x3d"+d:h+"\x26page\x3d0",c&&(h=h+"\x26sort\x3d"+c),e&&(h=h+"\x26commentId\x3d"+e));g({method:"GET",url:contextPath+h}).success(function(b,a,d,c){f.resolve(b)}).error(function(b,a,d,c){f.reject()});return f.promise};this.getReleaseNotes=function(a,b){return g({method:"GET",url:contextPath+"/releaseNotes?taskId\x3d"+a+"\x26taskUid\x3d"+b})};this.postComment=function(a){k.setLogoutTimer();
var b=l.defer();g({method:"POST",url:contextPath+"/comment/post",data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.deleteComment=function(a){k.setLogoutTimer();var b=l.defer();g({method:"POST",url:contextPath+"/comment/delete",data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.submitCommentReport=function(a){k.setLogoutTimer();var b=l.defer();g({method:"POST",url:contextPath+"/comment/report",
data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.loadRelatedTasks=function(a,b){k.setLogoutTimer();var d=l.defer(),c="";b&&(c="\x26marketUniqueKey\x3d"+b);var c=contextPath+"/task/related?uid\x3d"+a+c,e=(new Date).getTime();g({method:"GET",url:c+("\x26_\x3d"+e)}).success(function(b,a,c,e){d.resolve(b)}).error(function(b,a,c,e){d.reject(a)});return d.promise};this.postCommentVote=function(a){k.setLogoutTimer();return g({method:"POST",url:contextPath+
"/comment/vote",data:a})};this.setFavorite=function(a){k.setLogoutTimer();return g({method:"POST",url:contextPath+"/favorite",data:a})};this.submitFeedback=function(a){k.setLogoutTimer();var b=l.defer();g({method:"POST",url:contextPath+"/feedback/post",data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.saveFavorites=function(a){k.setLogoutTimer();var b=l.defer();g({method:"POST",url:contextPath+"/favorite/sort",data:a}).success(function(a,
c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.saveMostRecent=function(a){k.setLogoutTimer();var b=l.defer();g({method:"POST",url:contextPath+"/history/remove",data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.getDatabasePreferences=function(){k.setLogoutTimer();return g({method:"GET",url:contextPath+"/preferences?_\x3d"+(new Date).getTime()})};this.savePreferences=function(a){k.setLogoutTimer();var b=
l.defer();g({method:"POST",url:contextPath+"/preferences",data:a}).success(function(a,c,e,f){b.resolve(a)}).error(function(a,c,e,f){b.reject(c)});return b.promise};this.savePreferencesToLocalStorage=function(a){if(a.userPreferences){var b={};for(index in a.userPreferences){var d=a.userPreferences[index];b[d.uniqueKey]=d.userPreferenceValues[0].value}store.disabled||(store.set("userPreferences",b),this.setUserPreferences(a))}};this.getPreferencesFromLocalStorage=function(){return!store.disabled?store.get("userPreferences"):
null};this.setUserPreferences=function(a){var b=this.getPreferencesFromLocalStorage();b?(b["TASK-NEW-WINDOW"]&&(a.shouldOpenInNewWindowPref="yes"==b["TASK-NEW-WINDOW"]),b["HIDE-FEATURED"]&&(a.hideFeaturedPref="yes"==b["HIDE-FEATURED"])):this.savePreferencesToLocalStorage(a)};this.evaluateStringBindings=function(a,b){return n(a)(b)};this.getCompiledTypeaheadHeader=function(a){var b;b='\x3cp class\x3d"h5 dropdown-header"\x3eFiltered by: \x3cspan class\x3d"h4 text-danger"\x3e'+$("body").attr("data-market-name");
b+=' :\x26nbsp;\x3cspan ng-if\x3d"!filter.roleUniqueKeys || filter.roleUniqueKeys.length \x3d\x3d 0"\x3eAll Roles\x3c/span\x3e\x3cspan ng-if\x3d"filter.roleUniqueKeys.length \x3d\x3d 1"\x3e{{roleMap[filter.roleUniqueKeys[0]]}}\x3c/span\x3e\x3cspan ng-if\x3d"filter.roleUniqueKeys.length \x3e 1"\x3e{{filter.roleUniqueKeys.length}} Roles\x3c/span\x3e\x3cspan ng-if\x3d"filter.categoryUniqueKey"\x3e :\x26nbsp;{{categoryMap[filter.categoryUniqueKey]}}\x3c/span\x3e';b+='\x3cspan ng-if\x3d"filter.tag"\x3e :\x26nbsp;{{filter.tag}}\x3c/span\x3e';
b+="\x3c/span\x3e\x3c/p\x3e";return p(b)(a)};this.filterCategories=function(a,b,d){return q("filter")(a,function(a){if(null==a.roleIds||0==a.roleIds.length)return!0;for(var e in b.roleUniqueKeys)if(0<=a.roleIds.indexOf(d[b.roleUniqueKeys[e]]))return!0;return!1},!0)}};taskStoreModule.controller("TaskStoreController",["$scope","$timeout","taskStoreService","alertService","sessionService","searchService","cookieService","mobileService",function(a,r,f,h,g,n,x,C){function l(b){a.menuOpen&&a.toggleMenu(!1);if("undefined"==typeof b||!1==b)a.editingFavorites=!1,a.editingMostRecent=!1,a.filter.edit=!1,u.length=0;n.saveFilter(a.filter);a.showCarousel=!1;r(function(){y(function(b){a.store.tasks=b;b.featuredTasks&&0<b.featuredTasks.length&&(a.showCarousel=!0);r(function(){window.scrollTo(0,
0)},0)})},0)}function y(b){var c=!1;a.pageData.isUserAuthenticated||(c=a.isViewingHome()||"_favorite_"==a.filter.taskCollectionUniqueKey||"_recentlyUsed_"==a.filter.taskCollectionUniqueKey);f.findTasks(a.filter,c).then(function(a){b(a)})}function m(){var b={tag:null,terms:null,marketUniqueKey:null,roleUniqueKeys:[],categoryUniqueKey:null,taskCollectionUniqueKey:null,pageNumber:0,edit:!1},c=n.getStoredFilter();angular.extend(b,c);null==b.roleUniqueKeys&&(b.roleUniqueKeys=[]);"undefined"!=typeof b.roleUniqueKey&&
(b.roleUniqueKey&&b.roleUniqueKeys.push(b.roleUniqueKey),delete b.roleUniqueKey);c=$("body").attr("data-market-key");b.pageNumber=0;var d=p("tag"),e=p("category"),k=p("role"),f="false"!=p("preserve"),h="true"==p("search"),g=$("body").attr("data-task-collection");"undefined"!=typeof g&&(null!=g&&0<g.length)&&(b.taskCollectionUniqueKey=g,b.categoryUniqueKey=null,b.terms=null,d=e=b.tag=null);h&&(f=!0,d=b.tag=null);d&&(b.tag=d,b.terms=null,b.categoryUniqueKey=null,b.taskCollectionUniqueKey=null);null!=
e&&(b.categoryUniqueKey=e,b.taskCollectionUniqueKey=null,b.tag=null);k&&(h=b.roleUniqueKeys.indexOf(k),0>h?b.roleUniqueKeys.push(k):b.roleUniqueKeys.splice(h,1),b.taskCollectionUniqueKey=null,!d&&!f&&(b.tag=null),!e&&!f&&(b.categoryUniqueKey=null));f?(angular.element(document).ready(function(){$("#search-field").typeahead("setQuery",b.terms?b.terms:"")}),a.searchTerms=b.terms):b.terms=null;"function"==typeof history.pushState&&(d=s("category",null),d=s("tag",null,d),d=s("preserve",null,d),d=s("search",
null,d),d=s("role",null,d),window.location!=d&&history.pushState(null,null,d));c&&(b.marketUniqueKey=c);return b}function p(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?\x26]"+a+"\x3d([^\x26#]*)").exec(location.search);return null==a?null:decodeURIComponent(a[1].replace(/\+/g," "))}function z(){a.pageData.categories=f.filterCategories(A,a.filter,a.roleIdMap);if(null!=a.filter.categoryUniqueKey){var b=!1,c;for(c in a.pageData.categories)if(a.filter.categoryUniqueKey==a.pageData.categories[c].uniqueKey){b=
!0;break}b||(a.filter.categoryUniqueKey=null)}}function s(a,c,d){d||(d=window.location.href);var e=RegExp("([?|\x26])"+a+"\x3d.*?(\x26|#|$)(.*)","gi");if(e.test(d)){if("undefined"!==typeof c&&null!==c)return d.replace(e,"$1"+a+"\x3d"+c+"$2$3");var k=d.split("#");d=k[0].replace(e,"$1$3").replace(/(&|\?)$/,"");"undefined"!==typeof k[1]&&null!==k[1]&&(d+="#"+k[1]);return d}"undefined"!==typeof c&&null!==c&&(e=-1!==d.indexOf("?")?"\x26":"?",k=d.split("#"),d=k[0]+e+a+"\x3d"+c,"undefined"!==typeof k[1]&&
null!==k[1]&&(d+="#"+k[1]));return d}function D(){var b=[{selector:"#search_box",label:"Enter your search",position:"bottomright",distance:1},{selector:"#login_button",label:"Personalize "+a.pageData.applicationName,position:"topleft",arrowPos:"left",distance:1},{selector:"#market_select",label:"Select your "+a.pageData.marketTitle,position:"bottomleft",arrowPos:"left",distance:1},{selector:"#role_select",label:"Select your role",position:"bottom",arrowPos:"bottom",distance:0.5},{selector:"#category_select",
label:"View a category",position:"bottomright",arrowPos:"right",distance:1},{selector:"#contact_button",label:"Ask for help",position:"top",arrowPos:"top",distance:0.5},{selector:"#carousel-featured",label:"Featured tasks",position:"bottom",arrowPos:"center",distance:1},{selector:"#menu_button",label:"Toggle menu bar",position:"left",arrowPos:"left",distance:2.25},{selector:".task-collection:first .see-more-button-desktop",label:"See all in this category",position:"bottom",arrowPos:"bottom",distance:1.5},
{selector:".task-collection:first .see-more-button",label:"See all in this category",position:"bottom",arrowPos:"bottom",distance:0.5}],c="Click",d="Hover";C.isMobile&&(c="Tap",d="Swipe");b.push({selector:".task-collection:first .task2:first",label:d+" for more details",position:"bottom",arrowPos:"bottom",distance:1});b.push({selector:".task-collection:first .task2:first",label:c+" to launch",position:"top",arrowPos:"top",distance:0.5});return new HelpText({name:"introTour",onStart:function(){a.menuOpen=
!1;window.scrollTo(0,0)},onExit:function(){},labels:b})}function B(){q=setTimeout(function(){$("#scrollTop").removeClass("in");t=!1},3E3)}a.contextPath=contextPath;a.showCarousel=!1;a.alertService=h;a.pageData={};a.pageData.allMarketsUrlKey=$("body").attr("data-all-markets-key");a.marketMap={};a.categoryMap={};a.roleMap={};a.roleIdMap={};var A=a.filter=null;a.filter=m();n.saveFilter(a.filter);f.getPageData().then(function(b){a.pageData=b;b.isUserAuthenticated&&(g.setLogoutDelayMinutes(b.logoutDelayMinutes),
"true"==p("login")&&n.storeOfflineIds());f.setUserPreferences(a.pageData);for(var c=a.pageData.markets.length,d=0;d<c;d++){var e=a.pageData.markets[d];a.marketMap[e.marketId]=e.name}c=a.pageData.categories.length;for(d=0;d<c;d++)e=a.pageData.categories[d],a.categoryMap[e.uniqueKey]=e.name;c=a.pageData.roles.length;for(d=0;d<c;d++)e=a.pageData.roles[d],a.roleMap[e.uniqueKey]=e.name,a.roleIdMap[e.uniqueKey]=e.roleId;c=[];for(d=0;d<a.filter.roleUniqueKeys.length;d++)e=a.filter.roleUniqueKeys[d],e in
a.roleMap||c.push(e);for(d=0;d<c.length;d++)e=c[d],e=a.filter.roleUniqueKeys.indexOf(e),a.filter.roleUniqueKeys.splice(e,1);null!=a.filter.categoryUniqueKey&&!(a.filter.categoryUniqueKey in a.categoryMap)&&(a.filter.categoryUniqueKey=null);A=angular.copy(b.categories);z();l();r(function(){null!=p("expert")?(store.set("introTourFinished",!0),store.set("TDPTourFinished",!0)):w=D()},1E3);g.getRequestedAction(a,"showFeedbackDialog( addSingleFavorite( removeSingleFavorite( showPreferencesDialog( editFavorites( editMostRecent( tryAgain(".split(" "))});
a.toggleMenu=function(b){"undefined"==typeof b&&(b=!a.menuOpen);b?($("#sidebar_menu").css({right:0,visibility:"visible"}),setTimeout(function(){$("#menuCloseButton").focus()},300)):($("#menu_button").focus(),$("#sidebar_menu").css({right:-227}),setTimeout(function(){$("#sidebar_menu").css({visibility:"hidden"})},400));a.menuOpen=b};a.searchSuggest={name:"tasks",remote:{url:contextPath+"/tasks/suggest",replace:function(b,c){b+="?q\x3d"+c;if(a.filter){a.filter.tag&&(b+="\x26tag\x3d"+encodeURIComponent(a.filter.tag));
if(a.filter.roleUniqueKeys)for(var d in a.filter.roleUniqueKeys)b+="\x26roleUniqueKeys\x3d"+encodeURIComponent(a.filter.roleUniqueKeys[d]);a.filter.marketUniqueKey&&(b+="\x26marketUniqueKey\x3d"+encodeURIComponent(a.filter.marketUniqueKey));a.filter.categoryUniqueKey&&(b+="\x26categoryUniqueKey\x3d"+encodeURIComponent(a.filter.categoryUniqueKey));a.filter.taskCollectionUniqueKey&&(b+="\x26taskCollectionUniqueKey\x3d"+encodeURIComponent(a.filter.taskCollectionUniqueKey))}return b}},header:f.getCompiledTypeaheadHeader(a)};
r(function(){$("input.tt-hint").attr("role","presentation").attr("aria-hidden","true")});a.store={tasks:{}};a.isViewingHome=function(){return a.filter?!(a.editingFavorites||a.editingMostRecent||a.filter.terms||a.filter.tag||a.filter.categoryUniqueKey||a.filter.taskCollectionUniqueKey):!0};a.isEditing=function(){return a.editingFavorites||a.editingMostRecent};a.clearFilters=function(){a.filter||(a.filter=m());a.filter.tag=null;a.filter.categoryUniqueKey=null;a.filter.taskCollectionUniqueKey=null;a.filter.pageNumber=
0;l()};a.clearSearch=function(){a.filter||(a.filter=m());"_favorite_"==a.filter.taskCollectionUniqueKey&&"function"==typeof history.pushState&&history.pushState(null,null,contextPath+"/store");a.filter.tag=null;a.filter.terms=null;a.filter.categoryUniqueKey=null;a.filter.taskCollectionUniqueKey=null;a.filter.pageNumber=0;a.searchTerms=null;$("#search-field").typeahead("setQuery","");l()};a.search=function(){a.filter||(a.filter=m());a.filter.terms=a.searchTerms;a.filter.taskCollectionUniqueKey=null;
a.filter.tag=null;a.filter.pageNumber=0;l()};a.removeCategory=function(){a.filter||(a.filter=m());a.filter.pageNumber=0;a.filter.categoryUniqueKey=null;l()};a.selectCategory=function(b){a.filter||(a.filter=m());a.filter.categoryUniqueKey=b;a.filter.taskCollectionUniqueKey=null;a.filter.tag=null;a.filter.pageNumber=0;l()};a.selectTaskCollection=function(b,c){"_favorite_"==b&&(!c&&"function"==typeof history.pushState)&&(history.pushState(null,null,contextPath+"/favorites"),a.filter.terms=null);a.filter||
(a.filter=m());a.filter.categoryUniqueKey=null;a.filter.taskCollectionUniqueKey=b;a.filter.tag=null;a.filter.pageNumber=0;a.filter.edit="undefined"==typeof c?!1:c;l(c)};a.roleIsSelected=function(b){return 0<=a.filter.roleUniqueKeys.indexOf(b)};a.toggleRole=function(b){var c=a.filter.roleUniqueKeys.indexOf(b);0<=c?a.filter.roleUniqueKeys.splice(c,1):a.filter.roleUniqueKeys.push(b);z();a.filter.pageNumber=0;l()};a.selectMarket=function(b){b?(x.createCookie("marketUniqueKey",b.uniqueKey,365,"/"),a.filter.marketUniqueKey=
b.uniqueKey):(x.deleteCookie("marketUniqueKey","/"),a.filter.marketUniqueKey=null);n.saveFilter(a.filter);window.location=contextPath+"/store"};a.getTaskUrl=function(b,c){a.filter||(a.filter=m());return a.filter.terms?b.marketUniqueKey&&a.filter.marketUniqueKey&&!c?contextPath+"/launch-task/"+a.filter.marketUniqueKey+"/"+b.uniqueKey+"?searchTerms\x3d"+encodeURIComponent(a.filter.terms):b.marketUniqueKey&&(!a.filter.marketUniqueKey||c)?contextPath+"/launch-task/"+b.marketUniqueKey+"/"+b.uniqueKey+
"?searchTerms\x3d"+encodeURIComponent(a.filter.terms):contextPath+"/launch-task/"+a.pageData.allMarketsUrlKey+"/"+b.uniqueKey+"?searchTerms\x3d"+encodeURIComponent(a.filter.terms):b.marketUniqueKey&&a.filter.marketUniqueKey&&!c?contextPath+"/launch-task/"+a.filter.marketUniqueKey+"/"+b.uniqueKey:b.marketUniqueKey&&(!a.filter.marketUniqueKey||c)?contextPath+"/launch-task/"+b.marketUniqueKey+"/"+b.uniqueKey:contextPath+"/launch-task/"+a.pageData.allMarketsUrlKey+"/"+b.uniqueKey};a.getTaskDetailsUrl=
function(b,c){var d;a.filter||(a.filter=m());d=b.marketUniqueKey&&a.filter.marketUniqueKey&&!c?contextPath+"/task/"+a.filter.marketUniqueKey+"/"+b.uniqueKey:b.marketUniqueKey&&(!a.filter.marketUniqueKey||c)?contextPath+"/task/"+b.marketUniqueKey+"/"+b.uniqueKey:contextPath+"/task/"+a.pageData.allMarketsUrlKey+"/"+b.uniqueKey;a.filter.terms&&(d+="?searchTerms\x3d"+encodeURIComponent(a.filter.terms));return d};var u=[];a.loadNextPage=function(b){a.filter||(a.filter=m());a.filter.pageNumber++;y(function(a){for(index in a.taskCollections){var d=
a.taskCollections[index];if(d.uniqueKey==b.uniqueKey){b.tasks=b.tasks.concat(d.tasks);b.hasMore=d.hasMore;var e=d.tasks[0].taskId;r(function(){$("#task_"+b.uniqueKey+"_"+e).focus()});break}}})};a.getTaskCountMessage=function(b){var c="";if(b.hasMore){if("undefined"!=typeof a.pageData&&null!=a.pageData){var d=(a.filter.pageNumber+1)*a.pageData.tasksPerPage;d>b.totalSize?d=b.totalSize:c+="first ";c+=d}}else c+=b.totalSize;return c};a.feedbackValues={concernType:"",comments:"",replyEmail:""};a.showFeedbackDialog=
function(){!a.pageData||a.pageData.feedbackRequiresAuthentication&&!a.pageData.isUserAuthenticated?g.login("showFeedbackDialog()"):(a.menuOpen&&a.toggleMenu(!1),$("#feedbackModal").modal("show"),$("#feedbackComments").focus())};a.disableFeedbackSubmit=!1;a.submitFeedback=function(){a.disableFeedbackSubmit||(a.disableFeedbackSubmit=!0,f.submitFeedback({type:a.feedbackValues.concernType,comment:a.feedbackValues.comments,replyEmail:a.feedbackValues.replyEmail}).then(function(){a.feedbackValues.concernType=
null;a.feedbackValues.comments=null;a.feedbackValues.replyEmail=null;h.addAlert("Feedback submitted successfully","success",!0);a.disableFeedbackSubmit=!1},function(){h.addAlert("Could not submit your feedback at this time. Please try again later.","danger");a.disableFeedbackSubmit=!1}),$("#feedbackModal").modal("hide"))};a.showPreferencesDialog=function(){!a.pageData||!a.pageData.isUserAuthenticated?g.login("showPreferencesDialog()"):(a.menuOpen&&a.toggleMenu(!1),f.getDatabasePreferences().success(function(b,
c,d){null!=d("content-type")&&0>d("content-type").indexOf("json")?g.login("tryAgain()"):(a.pageData.userPreferences=b,$("#preferencesModal").modal("show"),$("#preferencesModal input:first").focus())}).error(function(a,c){h.addAlert("Could not retrieve latest preference settings. ("+c+")","danger",!0)}))};a.disablePreferencesSubmit=!1;a.savePreferences=function(){a.disablePreferencesSubmit||(a.disablePreferencesSubmit=!0,f.savePreferences(a.pageData.userPreferences).then(function(){f.getPageData().then(function(b){a.pageData=
b;f.savePreferencesToLocalStorage(a.pageData)});h.addAlert("Preferences saved successfully","success",!0);a.disablePreferencesSubmit=!1},function(){h.addAlert("Could not save your preferences at this time. Please try again later. ("+status+")","danger");a.disablePreferencesSubmit=!1}),$("#preferencesModal").modal("hide"))};a.widthStyle=function(a){return{width:a+"%"}};a.saveFavoritesPending=!1;a.editingFavorites=!1;a.editFavorites=function(b){!a.pageData||!a.pageData.isUserAuthenticated?g.login('editFavorites("'+
b+'")'):(a.selectTaskCollection(b,!0),a.editingFavorites=!0)};a.saveFavorites=function(b){if(!a.saveFavoritesPending){var c=[];if(b.tasks)for(index in b.tasks)c.push(b.tasks[index].uid);a.saveFavoritesPending=!0;f.saveFavorites(c).then(function(){a.editingFavorites=!1;a.saveFavoritesPending=!1;0<c.length?a.selectTaskCollection(b.uniqueKey,!1):a.clearFilters();n.storeOfflineIds()},function(b){301==b||302==b||(a.saveFavoritesPending=!1,h.addAlert("Could not save your favorites at this time. Please try again later.",
"danger"))})}};a.saveMostRecentPending=!1;a.editingMostRecent=!1;a.editMostRecent=function(b){!a.pageData||!a.pageData.isUserAuthenticated?g.login('editMostRecent("'+b+'")'):(a.selectTaskCollection(b,!0),a.editingMostRecent=!0)};a.saveMostRecent=function(b){a.saveMostRecentPending||(a.saveMostRecentPending=!0,f.saveMostRecent(u).then(function(){a.editingMostRecent=!1;a.saveMostRecentPending=!1;0<b.tasks.length?a.selectTaskCollection(b.uniqueKey,!1):a.clearFilters();n.storeOfflineIds();u.length=0},
function(b){301==b||302==b||(a.saveMostRecentPending=!1,h.addAlert("Could not save your most recent preferences at this time. Please try again later.","danger"))}))};a.removeTask=function(b,c){b.tasks&&(b.tasks.splice(b.tasks.indexOf(c),1),a.editingMostRecent&&u.push(c.uid))};a.addSingleFavorite=function(b,c){!a.pageData||!a.pageData.isUserAuthenticated?g.login('addSingleFavorite("'+b+'")'):(a.saveFavoritesPending=!0,f.setFavorite({taskUid:b,status:!0}).success(function(b,e,k,f){null!=k("content-type")&&
0>k("content-type").indexOf("json")?g.login("tryAgain()"):(a.isViewingHome()?l():"function"==typeof c&&c(!0),a.saveFavoritesPending=!1)}).error(function(b,e,f,g){a.saveFavoritesPending=!1;h.addAlert("Failed to add your favorite ("+e+")","danger");a.saveFavoritesPending=!1;"function"==typeof c&&c(!1)}))};a.removeSingleFavorite=function(b,c){!a.pageData||!a.pageData.isUserAuthenticated?g.login('removeSingleFavorite("'+b+'")'):(a.saveFavoritesPending=!0,f.setFavorite({taskUid:b,status:!1}).success(function(b,
e,f,h){null!=f("content-type")&&0>f("content-type").indexOf("json")?g.login("tryAgain()"):(a.isViewingHome()||"_favorite_"==a.filter.taskCollectionUniqueKey?l():"function"==typeof c&&c(!0),a.saveFavoritesPending=!1)}).error(function(b,e,f,g){a.saveFavoritesPending=!1;h.addAlert("Failed to remove your favorite ("+e+")","danger");a.saveFavoritesPending=!1;"function"==typeof c&&c(!1)}))};a.evaluateStringWithBindings=function(b){return f.evaluateStringBindings(b,a)};a.tryAgain=function(){h.addAlert("Your sesson was lost and has been restored. You will need to perform the desired action again.",
"warning")};var w=null;a.restartIntro=function(){a.toggleMenu(!1);w&&w.show()};$(window).resize(function(){});var v=null,t=!1,q=null;$(window).scroll(function(a){null==v&&(v=this.pageYOffset);10<this.pageYOffset&&this.pageYOffset<v?t?null!=q&&(clearTimeout(q),B()):($("#scrollTop").addClass("in"),B(),t=!0):t&&($("#scrollTop").removeClass("in"),t=!1,null!=q&&(clearTimeout(q),q=null));v=this.pageYOffset})}]);taskStoreModule.controller("TaskDefinitionController",["$scope","$timeout","taskStoreService","alertService","sessionService","searchService","cookieService","commentReplyService",function(a,n,d,g,h,p,v,s){function y(a){n(function(){$("#comment_"+a).focus();$("#commentList").scrollTop($("#comment_"+a).position().top-$("#comment_"+a).parent().position().top)})}function w(b){a.comments&&0<a.comments.length?d.getComments(l,a.taskDisplayVersionId,q,t,a.comments[a.comments.length-1].commentId).then(function(a){b(a)}):
d.getComments(l,a.taskDisplayVersionId,q,t).then(function(a){b(a)})}function x(a){n(function(){var c=$("#comment_"+a);c.focus();c.addClass("new");n(function(){c.addClass("active");n(function(){c.removeClass("new");c.removeClass("active")},3E3)},500)})}function z(){return new HelpText({name:"TDPTour",onStart:function(){a.menuOpen=!1},labels:[{selector:"#search_box",label:"Enter new search",position:"bottomleft",distance:1},{selector:"#login_button",label:"Personalize "+a.pageData.applicationName,position:"topleft",
arrowPos:"left",distance:1},{selector:"#market_select",label:"Select your "+a.pageData.marketTitle,position:"bottomleft",arrowPos:"left",distance:1},{selector:"#role_select",label:"Select your role",position:"bottom",arrowPos:"bottom",distance:0.5},{selector:"#category_select",label:"View a category",position:"bottomright",arrowPos:"right",distance:1},{selector:"#contact_button",label:"Ask for help",position:"topright",arrowPos:"right",distance:0.5},{selector:"#settings_button",label:"Set your preferences",
position:"bottom",arrowPos:"bottom",distance:1},{selector:"#launch_button",label:"Launch task",position:"bottomright",arrowPos:"right",distance:1},{selector:"#mobile_launch_button",label:"Launch task",position:"topright",arrowPos:"top"},{selector:"#favorite_button",label:"Add as a favorite",position:"bottomleft",arrowPos:"left",distance:1.5},{selector:"#mobile_favorite_button",label:"Add as a favorite",position:"bottomright",arrowPos:"bottom",distance:0.5},{selector:"#screenshot_block img:first",
label:"Click/tap for screenshot of task",position:"top",arrowPos:"center",distance:1},{selector:"#feedback_block .user-rating",label:"Click/tap a star to rate",position:"bottom",distance:1},{selector:"#contact_block",label:"Get help with this task",position:"top",arrowPos:"center",distance:1},,{selector:"#tagList .tag:first",label:"Click/tap to see other tasks",position:"top",arrowPos:"top",distance:1},{selector:"#menu_button",label:"Toggle menu bar",position:"left",arrowPos:"left",distance:1.5},
{selector:"#commentList i.glyphicon-flag:visible:first",label:"Flag comment as inappropriate",position:"bottomleft",arrowPos:"left",distance:1},{selector:"#commentList i.glyphicon-trash:visible:first",label:"Delete your comment",position:"bottomleft",arrowPos:"left",distance:1},,{selector:"#comment_sort_block",label:"Change how comments are sorted",position:"top",arrowPos:"top",distance:0.5}]})}a.alertService=g;a.pageData={};a.pageData.allMarketsUrlKey=$("body").attr("data-all-markets-key");a.currentMarket=
null;a.filter=p.getStoredFilter();a.filter?(a.currentMarket=a.filter.marketUniqueKey,a.searchTerms=a.filter.terms,a.searchTerms&&$("#search-field").typeahead("setQuery",a.searchTerms)):(a.filter={tag:null,terms:null,marketUniqueKey:null,roleUniqueKeys:[],categoryUniqueKey:null,taskCollectionUniqueKey:null,pageNumber:0,edit:!1},p.saveFilter(a.filter));var l=$("body").attr("data-task-uid"),m=Number($("body").attr("data-task-id"));$("iframe").each(function(){var a=$(this).attr("src");$(this).attr("src",
a+"?wmode\x3dtransparent")});a.toggleMenu=function(b){"undefined"==typeof b&&(b=!a.menuOpen);b?($("#sidebar_menu").css({right:0,visibility:"visible"}),setTimeout(function(){$("#menuCloseButton").focus()},300)):($("#menu_button").focus(),$("#sidebar_menu").css({right:-227}),setTimeout(function(){$("#sidebar_menu").css({visibility:"hidden"})},400));a.menuOpen=b};a.searchSuggest={name:"tasks",remote:{url:contextPath+"/tasks/suggest",replace:function(b,c){b+="?q\x3d"+c;if(a.filter){a.filter.tag&&(b+=
"\x26tag\x3d"+encodeURIComponent(a.filter.tag));if(a.filter.roleUniqueKeys)for(var e in a.filter.roleUniqueKeys)b+="\x26roleUniqueKeys\x3d"+encodeURIComponent(a.filter.roleUniqueKeys[e]);a.filter.marketUniqueKey&&(b+="\x26marketUniqueKey\x3d"+encodeURIComponent(a.filter.marketUniqueKey));a.filter.categoryUniqueKey&&(b+="\x26categoryUniqueKey\x3d"+encodeURIComponent(a.filter.categoryUniqueKey));a.filter.taskCollectionUniqueKey&&(b+="\x26taskCollectionUniqueKey\x3d"+encodeURIComponent(a.filter.taskCollectionUniqueKey))}return b}},
header:d.getCompiledTypeaheadHeader(a)};n(function(){$("input.tt-hint").attr("role","presentation").attr("aria-hidden","true")});a.clearFilters=function(){a.filter.tag=null;a.filter.roleUniqueKeys=null;a.filter.categoryUniqueKey=null;a.filter.taskCollectionUniqueKey=null;a.filter.pageNumber=0;p.saveFilter(a.filter)};a.search=function(){a.filter.terms=a.searchTerms;a.filter.taskCollectionUniqueKey=null;a.filter.pageNumber=0;p.saveFilter(a.filter);var b=contextPath+"/store";a.filter.marketUniqueKey&&
(b+="/"+a.filter.marketUniqueKey);window.location=b+"?search\x3dtrue"};a.selectMarket=function(b){b?(v.createCookie("marketUniqueKey",b.uniqueKey,365,"/"),a.filter.marketUniqueKey=b.uniqueKey):(v.deleteCookie("marketUniqueKey","/"),a.filter.marketUniqueKey=null);p.saveFilter(a.filter);window.location=contextPath+"/store"};a.comments=[];a.hasMoreComments=null;a.ratingData=null;a.versionRatingData=null;a.ratingsClasses=["progress-bar-success","progress-bar-primary","progress-bar-info","progress-bar-warning",
"progress-bar-danger"];a.ratingText="no rating;extremely dislike;don't like it;it's ok;it's good;it's great".split(";");a.rating=0;a.commentText="";a.marketMap={};a.marketUniqueKeyMap={};a.categoryMap={};a.roleMap={};a.roleIdMap={};a.currentCommentId=null;a.taskDisplayVersionId=m;var q=0,t=0;d.getPageData(l).then(function(b){a.pageData=b;b.isUserAuthenticated&&h.setLogoutDelayMinutes(b.logoutDelayMinutes);d.setUserPreferences(a.pageData);for(var c=a.pageData.markets.length,e=0;e<c;e++){var f=a.pageData.markets[e];
a.marketMap[f.marketId]=f.name;a.marketUniqueKeyMap[f.uniqueKey]=f.name}c=a.pageData.categories.length;for(e=0;e<c;e++)f=a.pageData.categories[e],a.categoryMap[f.uniqueKey]=f.name;c=a.pageData.roles.length;for(e=0;e<c;e++)f=a.pageData.roles[e],a.roleMap[f.uniqueKey]=f.name,a.roleIdMap[f.uniqueKey]=f.roleId;null!=b.userComment?(a.rating=b.userComment.rating||0,a.commentText=b.userComment.comment||"",a.commentUserAlias=b.userComment.userAlias||b.commentUserAlias,a.currentCommentId=b.userComment.commentId):
(a.rating=0,a.commentText="",a.commentUserAlias=b.commentUserAlias);fullCategoriesList=angular.copy(b.categories);a.pageData.categories=d.filterCategories(fullCategoriesList,a.filter,a.roleIdMap);h.getRequestedAction(a,"showPreferencesDialog( showFeedbackDialog( flagComment( commentVote( writeReview( removeFavorite( addFavorite( addSingleFavorite( removeSingleFavorite( tryAgain(".split(" "));n(function(){var a;a="expert".replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?\x26]"+a+"\x3d([^\x26#]*)").exec(location.search);
null!=(null==a?null:decodeURIComponent(a[1].replace(/\+/g," ")))?(store.set("introTourFinished",!0),store.set("TDPTourFinished",!0)):u=z()},1E3)});a.getComments=function(b,c){b!=m&&$("#commentArea").hasClass("in")&&$("#commentArea").collapse("hide");d.getComments(l,b).then(function(e){a.comments=e.comments;a.hasMoreComments=e.hasMore;a.totalComments=e.totalComments;b==m&&(a.ratingData=e.ratingData);a.versionRatingData=e.ratingData;"function"==typeof c&&c()})};a.getReleaseNotes=function(b){d.getReleaseNotes(b,
l).success(function(b,e,f,k){a.releaseNotes=b}).error(function(a,b,f,k){})};a.loadNextPageComments=function(b){q++;w(function(b){a.comments=a.comments.concat(b.comments);a.hasMoreComments=b.hasMore;0<b.comments.length&&y(b.comments[0].commentId)})};a.loadVersionData=function(){q=0;a.getComments(a.taskDisplayVersionId);a.getReleaseNotes(a.taskDisplayVersionId)};a.loadVersionData();d.loadRelatedTasks(l,null!=a.filter?a.filter.marketUniqueKey:"").then(function(b){a.relatedTasks=b},function(a){g.addAlert("Failed to load related tasks ("+
a+")","danger")});a.addFavorite=function(b){if(!a.pageData||!a.pageData.isUserAuthenticated)h.login("addFavorite()");else if(b&&!b.favorite||!b&&!a.pageData.isFavorite)a.favoritePending=!0,d.setFavorite({taskUid:b?b.uid:l,status:!0}).success(function(c,e,f,k){null!=f("content-type")&&0>f("content-type").indexOf("json")?h.login("tryAgain()"):(b?b.favorite=!0:a.pageData.isFavorite=!0,a.favoritePending=!1)}).error(function(b,e,f,k){a.favoritePending=!1;g.addAlert("Failed to add your favorite ("+e+")",
"danger")})};a.removeFavorite=function(b){if(!a.pageData||!a.pageData.isUserAuthenticated)h.login("removeFavorite()");else if(b&&b.favorite||!b&&a.pageData.isFavorite)a.favoritePending=!0,d.setFavorite({taskUid:b?b.uid:l,status:!1}).success(function(c,e,f,k){null!=f("content-type")&&0>f("content-type").indexOf("json")?h.login("tryAgain()"):(b?b.favorite=!1:a.pageData.isFavorite=!1,a.favoritePending=!1)}).error(function(b,e,f,k){a.favoritePending=!1;g.addAlert("Failed to remove your favorite ("+e+
")","danger")})};a.addSingleFavorite=function(b,c){!a.pageData||!a.pageData.isUserAuthenticated?h.login('addSingleFavorite("'+b+'")'):(a.saveFavoritesPending=!0,d.setFavorite({taskUid:b,status:!0}).success(function(b,f,k,d){null!=k("content-type")&&0>k("content-type").indexOf("json")?h.login("tryAgain()"):(a.saveFavoritesPending=!1,c&&c(!0))}).error(function(b,f,k,d){a.saveFavoritesPending=!1;g.addAlert("Failed to add your favorite ("+f+")","danger");c&&c(!1)}))};a.removeSingleFavorite=function(b,
c){!a.pageData||!a.pageData.isUserAuthenticated?h.login('removeSingleFavorite("'+b+'")'):(a.saveFavoritesPending=!0,d.setFavorite({taskUid:b,status:!1}).success(function(b,f,d,g){null!=d("content-type")&&0>d("content-type").indexOf("json")?h.login("tryAgain()"):(c&&c(!0),a.saveFavoritesPending=!1)}).error(function(b,f,d,h){a.saveFavoritesPending=!1;c&&c(!1);g.addAlert("Failed to remove your favorite ("+f+")","danger")}))};a.getTaskUrl=function(b,c){a.filter||(a.filter=setupFilter());return a.filter.terms?
b.marketUniqueKey&&a.filter.marketUniqueKey&&!c?contextPath+"/launch-task/"+a.filter.marketUniqueKey+"/"+b.uniqueKey+"?searchTerms\x3d"+encodeURIComponent(a.filter.terms):b.marketUniqueKey&&(!a.filter.marketUniqueKey||c)?contextPath+"/launch-task/"+b.marketUniqueKey+"/"+b.uniqueKey+"?searchTerms\x3d"+encodeURIComponent(a.filter.terms):contextPath+"/launch-task/"+a.pageData.allMarketsUrlKey+"/"+b.uniqueKey+"?searchTerms\x3d"+encodeURIComponent(a.filter.terms):b.marketUniqueKey&&a.filter.marketUniqueKey&&
!c?contextPath+"/launch-task/"+a.filter.marketUniqueKey+"/"+b.uniqueKey:b.marketUniqueKey&&(!a.filter.marketUniqueKey||c)?contextPath+"/launch-task/"+b.marketUniqueKey+"/"+b.uniqueKey:contextPath+"/launch-task/"+a.pageData.allMarketsUrlKey+"/"+b.uniqueKey};a.getTaskDetailsUrl=function(b,c){var e;a.filter||(a.filter=setupFilter());e=b.marketUniqueKey&&a.filter.marketUniqueKey&&!c?contextPath+"/task/"+a.filter.marketUniqueKey+"/"+b.uniqueKey:b.marketUniqueKey&&(!a.filter.marketUniqueKey||c)?contextPath+
"/task/"+b.marketUniqueKey+"/"+b.uniqueKey:contextPath+"/task/"+a.pageData.allMarketsUrlKey+"/"+b.uniqueKey;a.filter.terms&&(e+="?searchTerms\x3d"+encodeURIComponent(a.filter.terms));return e};a.clearSearch=function(){p.clearFilter()};a.roleIsSelected=function(b){return 0<=a.filter.roleUniqueKeys.indexOf(b)};a.writeReview=function(){!a.pageData||!a.pageData.isUserAuthenticated?h.login("writeReview()"):($("#commentArea").collapse("toggle"),$("#userAlias").focus())};a.rateTaskWithKeyboard=function(b){var c=
null;null!=b.keyCode&&0<b.keyCode?c=b.keyCode:null!=b.charCode&&0<b.charCode&&(c=b.charCode);if(null!=c&&49<=c&&53>=c)return a.rating=c-48,b.preventDefault(),!1};a.submitComment=function(){var b=$("#commentArea textarea").attr("ng-maxlength");""!=a.commentText&&(a.commentText.length<=b&&""!=a.commentUserAlias&&100>=a.commentUserAlias.length)&&d.postComment({taskId:m,comment:a.commentText,userAlias:a.commentUserAlias,rating:a.rating}).then(function(b){var e=b.commentData;a.versionRatingData=b.ratingData;
$("#commentArea").collapse("hide");if(m!=a.taskDisplayVersionId)a.taskDisplayVersionId=m,a.getComments(m,function(){x(e.commentId)});else{b=null;for(var f in a.comments)if(a.comments[f].commentId==a.currentCommentId){b=f;break}null!=b?a.comments.splice(b,1):a.totalComments++;a.comments.unshift(e);x(e.commentId)}a.currentCommentId=e.commentId},function(a){403==a?g.addAlert("You are not allowed to comment.","warning"):g.addAlert("Failed to post your comment ("+a+")","danger");window.scrollTo(0,0)})};
a.commentVotePending=!1;a.commentVote=function(b,c){a.commentVotePending=!0;!a.pageData||!a.pageData.isUserAuthenticated?h.login("commentVote("+b+","+c+")"):d.postCommentVote({commentId:b,vote:c}).success(function(c,f,d,g){if(null!=d("content-type")&&0>d("content-type").indexOf("json"))h.login("tryAgain()");else{if(a.comments)for(f=0;f<a.comments.length;f++)if(d=a.comments[f],d.commentId==b){d.voteUps=c.voteUps;d.voteDowns=c.voteDowns;d.voted=c.voted;break}a.commentVotePending=!1}}).error(function(b,
c,d,h){a.commentVotePending=!1;401==c?(g.addAlert("You cannot vote for your own comment.","warning"),window.scrollTo(0,0)):403==c?(g.addAlert("You are not allowed to vote.","warning"),window.scrollTo(0,0)):g.addAlert("Failed to vote on comment ("+c+")","danger")})};a.confirmDeleteComment=function(b){a.deleteCommentId=b;$("#confirmDeleteModal").modal("show")};a.deleteComment=function(b){d.deleteComment(b).then(function(c){a.ratingData=c;if(a.comments)for(c=0;c<a.comments.length;c++)if(a.comments[c].commentId==
b){a.comments.splice(c,1);a.totalComments--;break}},function(a){g.addAlert("Failed to delete your comment ("+a+")","danger")});$("#confirmDeleteModal").modal("hide")};a.sortCommentsType=function(b){q=0;t=b;w(function(b){a.comments=b.comments;a.hasMoreComments=b.hasMore;$("#commentList").scrollTop(0)})};a.concernType="";a.concernComments="";a.modalOpts={backdropFade:!0,dialogFade:!0};a.flagComment=function(b){a.pageData.isUserAuthenticated?(a.concernType="",a.concernComments="",a.commentId=b,$("#flagCommentModal").modal("show")):
h.login("flagComment("+b+")")};a.closeFlagModal=function(){$("#flagCommentModal").modal("hide")};a.submitConcern=function(){d.submitCommentReport({type:a.concernType,text:a.concernComments,commentId:a.commentId}).then(function(a){g.addAlert("Report submitted successfully.","success",!0)},function(a){401==a?(g.addAlert("You cannot report your own comment.","warning"),window.scrollTo(0,0)):g.addAlert("Failed to submit your report ("+a+")","danger")});$("#flagCommentModal").modal("hide")};a.feedbackValues=
{concernType:"",comments:"",replyEmail:""};a.showFeedbackDialog=function(){!a.pageData||a.pageData.feedbackRequiresAuthentication&&!a.pageData.isUserAuthenticated?h.login("showFeedbackDialog()"):(a.menuOpen&&a.toggleMenu(!1),$("#feedbackModal").modal("show"),$("#feedbackComments").focus())};a.disableFeedbackSubmit=!1;a.submitFeedback=function(){a.disableFeedbackSubmit||(a.disableFeedbackSubmit=!0,d.submitFeedback({type:a.feedbackValues.concernType,comment:a.feedbackValues.comments,replyEmail:a.feedbackValues.replyEmail}).then(function(){a.feedbackValues.concernType=
null;a.feedbackValues.comments=null;a.feedbackValues.replyEmail=null;g.addAlert("Feedback submitted successfully","success",!0);a.disableFeedbackSubmit=!1},function(){g.addAlert("Could not submit your feedback at this time. Please try again later.","danger");a.disableFeedbackSubmit=!1}),$("#feedbackModal").modal("hide"))};a.showPreferencesDialog=function(){!a.pageData||!a.pageData.isUserAuthenticated?h.login("showPreferencesDialog()"):(a.menuOpen&&a.toggleMenu(!1),d.getDatabasePreferences().success(function(b,
c,e){null!=e("content-type")&&0>e("content-type").indexOf("json")?h.login("tryAgain()"):(a.pageData.userPreferences=b,$("#preferencesModal").modal("show"),$("#preferencesModal input:first").focus())}).error(function(a,c){g.addAlert("Could not retrieve latest preference settings. ("+c+")","danger",!0)}))};a.disablePreferencesSubmit=!1;a.savePreferences=function(){a.disablePreferencesSubmit||(a.disablePreferencesSubmit=!0,d.savePreferences(a.pageData.userPreferences).then(function(){d.getPageData().then(function(b){a.pageData=
b;d.savePreferencesToLocalStorage(a.pageData);d.setUserPreferences(a.pageData)});g.addAlert("Preferences saved successfully","success",!0);a.disablePreferencesSubmit=!1},function(){g.addAlert("Could not save your preferences at this time. Please try again later.","danger");a.disablePreferencesSubmit=!1}),$("#preferencesModal").modal("hide"))};a.evaluateStringWithBindings=function(b){return d.evaluateStringBindings(b,a)};a.replyToComment=function(b){s.getCommentReply(b.commentId).success(function(c,
e,f,d){a.commentReplyingTo=b;a.commentReply=c;$("#replyModal").modal("show")}).error(function(a,b,d,h){g.addAlert("Could not retrieve details for the comment response ("+b+").","danger")})};var r=null;a.confirmDeleteReply=function(a){r=a;$("#confirmDeleteReplyModal").modal("show")};a.deleteReply=function(){a.disableReplySubmit||(a.disableReplySubmit=!0,s.getCommentReply(r.commentId).success(function(b,c,e,d){s.deleteCommentReply(b).success(function(b,c,d,e){r=r.commentReply=null;a.disableReplySubmit=
!1}).error(function(b,c,d,e){g.addAlert("Could not delete this comment response ("+c+").","danger");r=null;a.disableReplySubmit=!1})}).error(function(a,c,d,f){g.addAlert("Could not retrieve details for the comment response ("+c+").","danger")}));$("#confirmDeleteReplyModal").modal("hide")};var u=null;a.restartIntro=function(){a.toggleMenu(!1);u&&u.show()};a.widthStyle=function(a){return{width:a+"%"}};a.scrollToTop=function(){window.scrollTo(0,0)};a.executeUrl=function(a){window.location=a};a.displayTaskMobileMenu=
function(a,c){a.mobileMenuVisible=c};a.tryAgain=function(){g.addAlert("Your sesson was lost and has been restored. You will need to perform the desired action again.","warning")};touchScroll("div.media-scroll")}]);